import{a as R,l as ve,u as ee,m as re,h as he}from"./moment.b8ce3571.js";import{f as w,a as m,b as y,d as a,h as ge,G as le,r as B,o as J,g as N,w as s,i as X,j as t,k as fe,l as r,m as z,u,t as M,n as ye,p as we,e as xe,q as U,s as P,R as te,N as ne,v as ke,x as Ce,y as A,z as oe,A as se,B as $e,F as Ie,C as Be,D as Le,E as ae}from"./index.7309ae6e.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";var be="./assets/logo.8db43109.png";const Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=a("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Pe=[Fe];var ze=w({name:"FlashOutline",render:function(n,e){return m(),y("svg",Se,Pe)}});const Me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},De=ge('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),Ve=[De];var Te=w({name:"List",render:function(n,e){return m(),y("svg",Me,Ve)}});const qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ee=a("path",{d:"M208 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Re=a("path",{d:"M352 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Ae=[Ee,Re];var Ne=w({name:"Pause",render:function(n,e){return m(),y("svg",qe,Ae)}});const Ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},je=a("path",{d:"M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440z",fill:"currentColor"},null,-1),He=[je];var Oe=w({name:"Play",render:function(n,e){return m(),y("svg",Ue,He)}});const Ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ge=a("path",{d:"M112 64a16 16 0 0 1 16 16v136.43L360.77 77.11a35.13 35.13 0 0 1 35.77-.44c12 6.8 19.46 20 19.46 34.33v290c0 14.37-7.46 27.53-19.46 34.33a35.14 35.14 0 0 1-35.77-.45L128 295.57V432a16 16 0 0 1-32 0V80a16 16 0 0 1 16-16z",fill:"currentColor"},null,-1),Xe=[Ge];var Je=w({name:"PlaySkipBack",render:function(n,e){return m(),y("svg",Ke,Xe)}});const Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},We=a("path",{d:"M400 64a16 16 0 0 0-16 16v136.43L151.23 77.11a35.13 35.13 0 0 0-35.77-.44C103.46 83.47 96 96.63 96 111v290c0 14.37 7.46 27.53 19.46 34.33a35.14 35.14 0 0 0 35.77-.45L384 295.57V432a16 16 0 0 0 32 0V80a16 16 0 0 0-16-16z",fill:"currentColor"},null,-1),Ye=[We];var Ze=w({name:"PlaySkipForward",render:function(n,e){return m(),y("svg",Qe,Ye)}});const et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},tt=a("path",{d:"M232 416a23.88 23.88 0 0 1-14.2-4.68a8.27 8.27 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8.27 8.27 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24zm-106.18-80zm-.27-159.86z",fill:"currentColor"},null,-1),nt=a("path",{d:"M320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81c0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336z",fill:"currentColor"},null,-1),ot=a("path",{d:"M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8z",fill:"currentColor"},null,-1),st=a("path",{d:"M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432z",fill:"currentColor"},null,-1),at=[tt,nt,ot,st];var rt=w({name:"VolumeHigh",render:function(n,e){return m(),y("svg",et,at)}});const lt={class:"user"},ut={class:"username"},ct=["src"],it=w({__name:"user",setup(f){const n=fe("reload"),e=le(),p=B(!1),v=B(""),{isLogin:o,cookie:x}=e,$=B(o),b=B("\u626B\u7801\u767B\u5F55");J(async()=>{const{data:i}=await c(x);!i.account||i.account.status==-10?e.isLogin=!1:($.value=!0,e.isLogin=!0,e.userInfo=i.profile)});async function T(i){return(await R({url:`http://120.48.115.17:3000/login/qr/check?key=${i}&timestamp=${Date.now()}`})).data}async function c(i=""){return(await R({url:`http://120.48.115.17:3000/login/status?timestamp=${Date.now()}`,method:"post",data:{cookie:i}})).data}async function d(){p.value=!0;let i;c(e.cookie);const F=(await R({url:`http://120.48.115.17:3000/login/qr/key?timestamp=${Date.now()}`})).data.data.unikey,C=await R({url:`http://120.48.115.17:3000/login/qr/create?key=${F}&qrimg=true&timestamp=${Date.now()}`});v.value=C.data.data.qrimg,i=setInterval(async()=>{const h=await T(F);if(b.value=h.msg,h.code===800&&(b.value="\u4E8C\u7EF4\u7801\u5DF2\u8FC7\u671F,\u8BF7\u91CD\u65B0\u83B7\u53D6",clearInterval(i)),h.code===803){clearInterval(i),b.value="\u767B\u5F55\u6210\u529F";let D=await c(h.cookie);e.isLogin=!0,e.userInfo=D.data.profile,e.cookie=h.cookie,p.value=!1,n()}},3e3)}const k=async()=>{const{data:i}=await ve();console.log(i),i.code===200&&(e.isLogin=!1,e.userInfo={},e.qrKey="",e.cookie="",n())};return(i,S)=>{const F=r("n-button"),C=r("n-avatar"),h=r("n-popover"),D=r("n-card"),H=r("n-modal");return m(),y("div",lt,[$.value?X("",!0):(m(),N(F,{key:0,quaternary:"",onClick:d},{default:s(()=>[z(" \u767B\u5F55 ")]),_:1})),$.value?(m(),N(h,{key:1,width:"trigger"},{trigger:s(()=>[a("div",null,[t(C,{round:"",size:24,src:u(e).userInfo.avatarUrl},null,8,["src"]),z(),a("span",ut,M(u(e).userInfo.nickname),1)])]),default:s(()=>[t(F,{size:"small",onClick:k},{default:s(()=>[z(" \u9000\u51FA\u767B\u5F55 ")]),_:1})]),_:1})):X("",!0),t(H,{show:p.value,"onUpdate:show":S[0]||(S[0]=O=>p.value=O)},{default:s(()=>[t(D,{style:{width:"600px"},title:"\u767B\u5F55",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":s(()=>[z(" X ")]),footer:s(()=>[z(M(b.value),1)]),default:s(()=>[a("img",{src:v.value,alt:""},null,8,ct)]),_:1})]),_:1},8,["show"])])}}});var dt=j(it,[["__scopeId","data-v-a28e670a"]]);const _t=f=>(we("data-v-58202a66"),f=f(),xe(),f),pt={class:"music-header"},mt=_t(()=>a("span",{class:"title"},"\u7F51\u6613\u4E91\u97F3\u4E50",-1)),vt=w({__name:"index",setup(f){const n=ye(),e=p=>{if(p.key==="Enter"){if(console.log(n.currentRoute),n.currentRoute.value.path==="/music/search"){n.push({query:{keywords:p.target.value}});return}n.push({path:"/music/search",query:{keywords:p.target.value}})}};return(p,v)=>{const o=r("n-avatar"),x=r("n-icon"),$=r("n-input");return m(),y("div",pt,[t(o,{round:"",size:48,src:u(be)},null,8,["src"]),z(),mt,t($,{placeholder:"\u641C\u7D22",onKeyup:e},{prefix:s(()=>[t(x,{component:u(ze)},null,8,["component"])]),_:1}),t(dt)])}}});var ht=j(vt,[["__scopeId","data-v-58202a66"]]);const gt={class:"left-menu"},ft=w({__name:"index",setup(f){const n=le(),e=B([]);U(()=>n.userInfo.userId,v=>{v&&ee(n.userInfo.userId).then(o=>{console.log(o.data.playlist)})}),J(()=>{n.userInfo.userId&&ee(n.userInfo.userId).then(v=>{v.data.playlist.forEach(o=>{e.value.push({label:()=>P(te,{to:{name:"songSheet",query:{id:o.id}}},{default:()=>o.name}),key:o.id,icon:()=>P("img",{src:o.coverImgUrl+"?param=40y40",class:"listcover"})})})})});const p=B([{label:()=>P(te,{to:{name:"mainPage",params:{}}},{default:()=>"\u4E3A\u6211\u63A8\u8350"}),key:"recommend"},{label:"\u6392\u884C\u699C",key:"rank"},{label:"\u6536\u85CF",key:"songList",children:e}]);return(v,o)=>{const x=r("n-menu");return m(),y("div",gt,[t(x,{options:p.value,indent:10},null,8,["options"])])}}});const yt={class:"songList"},wt=w({__name:"playList",setup(f){const n=re(),e=B(!0),p=c=>c.id===n.songs[n.currentIndex].id?"current":"",v=({play:c})=>[{title:"\u5C01\u9762",key:"cover",width:80,render(d){return P("img",{src:d.cover,class:"songcover"})}},{title:"\u6807\u9898",key:"title"},{title:"\u6B4C\u624B",key:"singer"},{title:"\u65F6\u957F",key:"length",render(d){return P("span",he(d.time).format("mm:ss"))}},{title:"\u64CD\u4F5C",key:"action",width:100,render(d){return[P(ne,{size:"small",onClick:()=>{c(d)}},{default:()=>"\u64AD\u653E"}),P(ne,{size:"small",onClick:()=>{b(d)}},{default:()=>"\u79FB\u9664"})]}}],o=B(n.songs),x=B(n.currentIndex);n.$subscribe((c,d)=>{o.value=d.songs,e.value=!1,setTimeout(()=>{e.value=!0},0)}),console.log(o.value),U(o,c=>{console.log(c)});const $=c=>{let d=o.value.findIndex(k=>k.id===c.id);x.value=d,n.currentIndex=d,console.log(d,o.value.length)},b=c=>{console.log(c);let d=o.value.findIndex(k=>k.id===c.id);o.value.splice(d,1),console.log(d,o.value.length)},T=v({play:$});return(c,d)=>{const k=r("n-data-table");return m(),y("div",yt,[e.value?(m(),N(k,{key:0,columns:u(T),data:o.value,bordered:!1,"max-height":400,"row-class-name":p},null,8,["columns","data"])):X("",!0)])}}});const xt={class:"player"},kt=["src"],Ct={class:"control"},$t={class:"vol"},It={class:"showMusicBox"},Bt={style:{"margin-right":"150px"}},Lt={style:{position:"relative"}},bt={class:"lyrics-container"},St=w({__name:"player",setup(f){const n=re(),e=ke({isPlaying:!1,active:!1,activeList:!1,currentTime:0,cover:"",name:"",length:0,progress:0,duration:0,volume:30,lyric:[],currentLine:-1,animationPlayState:"paused"}),{isPlaying:p,active:v,activeList:o,currentTime:x,cover:$,name:b,length:T,progress:c,duration:d,volume:k,lyric:i,currentLine:S,animationPlayState:F}=Ce(e),C=B(n.songs[n.currentIndex]);J(()=>{h.value.volume=k.value/100,h.value.src=C.value.src,e.lyric=Q(C.value.Lyric)}),U(C,_=>{console.log("currentSong",_),e.lyric=Q(_.Lyric),console.log("lyric",e.lyric),q()}),n.$subscribe((_,l)=>{C.value=l.songs[l.currentIndex]});const h=B(null),D=_=>{if(e.currentTime=Math.floor(h.value.currentTime),e.progress=e.currentTime/e.duration*100,!i.value)return;for(let g=0;g<i.value.length;g++)if(g===i.value.length-1||x.value<i.value[g+1].time){S.value=g;break}const l=document.querySelector(".lyrics-container li.active");if(l){const g=document.querySelector(".lyrics-container ul");g.scrollTop=l.offsetTop-g.clientHeight/2+l.clientHeight}},H=_=>{e.duration=Math.floor(h.value.duration),console.log("durationchange",e.duration)},O=()=>{console.log("ended")},q=()=>{e.isPlaying=!0,e.animationPlayState="running",ae(()=>{h.value.play()})},ue=()=>{e.isPlaying=!1,e.animationPlayState="paused",ae(()=>{h.value.pause()})},ce=()=>{e.isPlaying=!e.isPlaying,e.isPlaying?q():ue()},ie=()=>{n.currentIndex==0?n.currentIndex=n.songs.length-1:n.currentIndex--,q()},de=()=>{n.currentIndex==n.songs.length-1?n.currentIndex=0:n.currentIndex++,q()},K=_=>{const l=Math.floor(_/60),g=(_%60).toFixed(0);return`${l}:${g.toString().padStart(2,"0")}`},_e=_=>K(_*e.duration/100);U(c,_=>{});const pe=()=>{let _=e.progress*e.duration/100;isNaN(_)||(h.value.currentTime=_)},me=_=>{h.value.volume=_/100},Q=_=>_?_.split(`
`).map(g=>{const L=g.match(/^\[(\d{2}):(\d{2}\.\d{2,3})\](.*)/);if(L){const V=parseInt(L[1]),G=parseFloat(L[2]),E=L[3].trim();return{time:V*60+G,text:E}}else return null}).filter(g=>g!==null):void 0;return(_,l)=>{const g=r("n-image"),L=r("n-icon"),V=r("n-button"),G=r("n-button-group"),E=r("n-slider"),W=r("n-drawer-content"),Y=r("n-drawer");return m(),y("div",xt,[a("audio",{ref_key:"audio",ref:h,src:C.value.src,onTimeupdate:D,onDurationchange:H,onEnded:O},null,40,kt),t(g,{width:"60",src:C.value.cover,onClick:l[0]||(l[0]=I=>v.value=!0),"preview-disabled":""},null,8,["src"]),a("span",null,M(C.value.title),1),a("div",Ct,[t(G,null,{default:s(()=>[t(V,{round:"",onClick:ie},{icon:s(()=>[t(L,null,{default:s(()=>[t(u(Je))]),_:1})]),_:1}),t(V,{ghost:"",onClick:ce},{icon:s(()=>[t(L,null,{default:s(()=>[oe(t(u(Ne),null,null,512),[[se,u(p)]]),oe(t(u(Oe),null,null,512),[[se,!u(p)]])]),_:1})]),_:1}),t(V,{round:"",onClick:de},{icon:s(()=>[t(L,null,{default:s(()=>[t(u(Ze))]),_:1})]),_:1})]),_:1}),a("span",null,M(K(u(x)))+" / "+M(K(u(d))),1),t(E,{value:u(c),"onUpdate:value":l[1]||(l[1]=I=>A(c)?c.value=I:null),min:0,max:100,step:.01,onDragend:pe,"format-tooltip":_e},null,8,["value"]),a("div",$t,[t(L,null,{default:s(()=>[t(u(rt))]),_:1}),t(E,{value:u(k),"onUpdate:value":[l[2]||(l[2]=I=>A(k)?k.value=I:null),me],min:0,max:100,step:.01},null,8,["value"]),t(L,{onClick:l[3]||(l[3]=I=>o.value=!0)},{default:s(()=>[t(u(Te))]),_:1})])]),t(Y,{show:u(v),"onUpdate:show":l[4]||(l[4]=I=>A(v)?v.value=I:null),class:"lyric-drawer",placement:"top",to:"#my-music","mask-closable":!1,"show-mask":!1},{default:s(()=>[t(W,{title:"\u6B4C\u8BCD\u9875",closable:""},{default:s(()=>[a("div",It,[a("div",Bt,[a("div",Lt,[t(g,{width:"250",style:$e({animationPlayState:u(F)}),src:C.value.cover+"?param=350y350"},null,8,["style","src"])])]),a("div",bt,[a("ul",null,[(m(!0),y(Ie,null,Be(u(i),(I,Z)=>(m(),y("li",{key:Z,class:Le({active:u(S)===Z})},M(I.text),3))),128))])])])]),_:1})]),_:1},8,["show"]),t(Y,{show:u(o),"onUpdate:show":l[5]||(l[5]=I=>A(o)?o.value=I:null),width:502,placement:"right",to:"#my-music"},{default:s(()=>[t(W,{title:"\u64AD\u653E\u5217\u8868"},{default:s(()=>[t(wt)]),_:1})]),_:1},8,["show"])])}}});var Ft=j(St,[["__scopeId","data-v-c4efb8e4"]]);const Pt=w({__name:"index",setup(f){return(n,e)=>{const p=r("n-layout-header"),v=r("n-layout-sider"),o=r("RouterView"),x=r("n-layout-content"),$=r("n-layout"),b=r("n-layout-footer");return m(),N($,{id:"my-music"},{default:s(()=>[t(p,{class:"music-header"},{default:s(()=>[t(ht)]),_:1}),t($,{"has-sider":""},{default:s(()=>[t(v,{class:"music-left","content-style":"padding: 10px;","collapse-mode":"width"},{default:s(()=>[t(ft)]),_:1}),t(x,{class:"music-content","content-style":"padding: 24px;"},{default:s(()=>[t(o)]),_:1})]),_:1}),t(b,{class:"music-footer"},{default:s(()=>[t(Ft)]),_:1})]),_:1})}}});var Vt=j(Pt,[["__scopeId","data-v-40fe05c8"]]);export{Vt as default};
