import{a as A,l as he,u as ee,m as le,h as ge}from"./moment.1fd2899e.js";import{f as k,a as m,b as y,d as l,h as fe,G as re,r as b,w as T,o as J,g as U,i as s,j as X,k as t,l as ye,u as ue,m as r,n as M,q as c,t as D,p as we,e as ke,s as P,R as te,N as ne,v as xe,x as Ce,y as N,z as oe,A as se,B as $e,F as Ie,C as be,D as Be,E as ae}from"./index.8682a719.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";var Le="./assets/logo.8db43109.png";const Se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=l("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Pe=[Fe];var ze=k({name:"FlashOutline",render:function(n,e){return m(),y("svg",Se,Pe)}});const Me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},De=fe('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),Ve=[De];var Te=k({name:"List",render:function(n,e){return m(),y("svg",Me,Ve)}});const qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ee=l("path",{d:"M208 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Re=l("path",{d:"M352 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Ae=[Ee,Re];var Ne=k({name:"Pause",render:function(n,e){return m(),y("svg",qe,Ae)}});const Ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},je=l("path",{d:"M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440z",fill:"currentColor"},null,-1),He=[je];var Oe=k({name:"Play",render:function(n,e){return m(),y("svg",Ue,He)}});const Ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ge=l("path",{d:"M112 64a16 16 0 0 1 16 16v136.43L360.77 77.11a35.13 35.13 0 0 1 35.77-.44c12 6.8 19.46 20 19.46 34.33v290c0 14.37-7.46 27.53-19.46 34.33a35.14 35.14 0 0 1-35.77-.45L128 295.57V432a16 16 0 0 1-32 0V80a16 16 0 0 1 16-16z",fill:"currentColor"},null,-1),Xe=[Ge];var Je=k({name:"PlaySkipBack",render:function(n,e){return m(),y("svg",Ke,Xe)}});const Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},We=l("path",{d:"M400 64a16 16 0 0 0-16 16v136.43L151.23 77.11a35.13 35.13 0 0 0-35.77-.44C103.46 83.47 96 96.63 96 111v290c0 14.37 7.46 27.53 19.46 34.33a35.14 35.14 0 0 0 35.77-.45L384 295.57V432a16 16 0 0 0 32 0V80a16 16 0 0 0-16-16z",fill:"currentColor"},null,-1),Ye=[We];var Ze=k({name:"PlaySkipForward",render:function(n,e){return m(),y("svg",Qe,Ye)}});const et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},tt=l("path",{d:"M232 416a23.88 23.88 0 0 1-14.2-4.68a8.27 8.27 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8.27 8.27 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24zm-106.18-80zm-.27-159.86z",fill:"currentColor"},null,-1),nt=l("path",{d:"M320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81c0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336z",fill:"currentColor"},null,-1),ot=l("path",{d:"M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8z",fill:"currentColor"},null,-1),st=l("path",{d:"M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432z",fill:"currentColor"},null,-1),at=[tt,nt,ot,st];var lt=k({name:"VolumeHigh",render:function(n,e){return m(),y("svg",et,at)}});const rt={class:"user"},ut={class:"username"},ct=["src"],it=k({__name:"user",setup(f){const n=ye("reload"),e=re();console.log(e),ue();const p=b(!1),v=b(""),{isLogin:o,cookie:x}=e,w=b(o);console.log(w.value),T(w,a=>{console.log(a)});const S=b("\u626B\u7801\u767B\u5F55");J(async()=>{const{data:a}=await i(x);console.log(a),!a.account||a.account.status==-10?e.isLogin=!1:(w.value=!0,e.isLogin=!0,e.userInfo=a.profile)});async function q(a){return(await A({url:`http://120.48.115.17:3000/login/qr/check?key=${a}&timestamp=${Date.now()}`})).data}async function i(a=""){const B=await A({url:`http://120.48.115.17:3000/login/status?timestamp=${Date.now()}`,method:"post",data:{cookie:a}});return console.log(B.data),B.data}async function d(){p.value=!0;let a;i(e.cookie);const F=(await A({url:`http://120.48.115.17:3000/login/qr/key?timestamp=${Date.now()}`})).data.data.unikey,$=await A({url:`http://120.48.115.17:3000/login/qr/create?key=${F}&qrimg=true&timestamp=${Date.now()}`});v.value=$.data.data.qrimg,a=setInterval(async()=>{const h=await q(F);if(h.code===800&&(S.value="\u4E8C\u7EF4\u7801\u5DF2\u8FC7\u671F,\u8BF7\u91CD\u65B0\u83B7\u53D6",clearInterval(a)),h.code===803){clearInterval(a),S.value="\u767B\u5F55\u6210\u529F",console.log(h);let z=await i(h.cookie);console.log(z),e.isLogin=!0,e.userInfo=z.data.profile,e.cookie=h.cookie,p.value=!1,n()}},3e3)}const C=async()=>{const{data:a}=await he();console.log(a),a.code===200&&(e.isLogin=!1,e.userInfo={},e.qrKey="",e.cookie="",n())};return(a,B)=>{const F=r("n-button"),$=r("n-avatar"),h=r("n-popover"),z=r("n-card"),H=r("n-modal");return m(),y("div",rt,[w.value?X("",!0):(m(),U(F,{key:0,quaternary:"",onClick:d},{default:s(()=>[M(" \u767B\u5F55 ")]),_:1})),w.value?(m(),U(h,{key:1,width:"trigger"},{trigger:s(()=>[l("div",null,[t($,{round:"",size:24,src:c(e).userInfo.avatarUrl},null,8,["src"]),M(),l("span",ut,D(c(e).userInfo.nickname),1)])]),default:s(()=>[t(F,{size:"small",onClick:C},{default:s(()=>[M(" \u9000\u51FA\u767B\u5F55 ")]),_:1})]),_:1})):X("",!0),t(H,{show:p.value,"onUpdate:show":B[0]||(B[0]=O=>p.value=O)},{default:s(()=>[t(z,{style:{width:"600px"},title:"\u767B\u5F55",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":s(()=>[M(" X ")]),footer:s(()=>[M(D(S.value),1)]),default:s(()=>[l("img",{src:v.value,alt:""},null,8,ct)]),_:1})]),_:1},8,["show"])])}}});var dt=j(it,[["__scopeId","data-v-965daf72"]]);const _t=f=>(we("data-v-58202a66"),f=f(),ke(),f),pt={class:"music-header"},mt=_t(()=>l("span",{class:"title"},"\u7F51\u6613\u4E91\u97F3\u4E50",-1)),vt=k({__name:"index",setup(f){const n=ue(),e=p=>{if(p.key==="Enter"){if(console.log(n.currentRoute),n.currentRoute.value.path==="/music/search"){n.push({query:{keywords:p.target.value}});return}n.push({path:"/music/search",query:{keywords:p.target.value}})}};return(p,v)=>{const o=r("n-avatar"),x=r("n-icon"),w=r("n-input");return m(),y("div",pt,[t(o,{round:"",size:48,src:c(Le)},null,8,["src"]),M(),mt,t(w,{placeholder:"\u641C\u7D22",onKeyup:e},{prefix:s(()=>[t(x,{component:c(ze)},null,8,["component"])]),_:1}),t(dt)])}}});var ht=j(vt,[["__scopeId","data-v-58202a66"]]);const gt={class:"left-menu"},ft=k({__name:"index",setup(f){const n=re(),e=b([]);T(()=>n.userInfo.userId,v=>{v&&ee(n.userInfo.userId).then(o=>{console.log(o.data.playlist)})}),J(()=>{n.userInfo.userId&&ee(n.userInfo.userId).then(v=>{v.data.playlist.forEach(o=>{e.value.push({label:()=>P(te,{to:{name:"songSheet",query:{id:o.id}}},{default:()=>o.name}),key:o.id,icon:()=>P("img",{src:o.coverImgUrl+"?param=40y40",class:"listcover"})})})})});const p=b([{label:()=>P(te,{to:{name:"mainPage",params:{}}},{default:()=>"\u4E3A\u6211\u63A8\u8350"}),key:"recommend"},{label:"\u6392\u884C\u699C",key:"rank"},{label:"\u6536\u85CF",key:"songList",children:e}]);return(v,o)=>{const x=r("n-menu");return m(),y("div",gt,[t(x,{options:p.value,indent:10},null,8,["options"])])}}});const yt={class:"songList"},wt=k({__name:"playList",setup(f){const n=le(),e=b(!0),p=i=>i.id===n.songs[n.currentIndex].id?"current":"",v=({play:i})=>[{title:"\u5C01\u9762",key:"cover",width:80,render(d){return P("img",{src:d.cover,class:"songcover"})}},{title:"\u6807\u9898",key:"title"},{title:"\u6B4C\u624B",key:"singer"},{title:"\u65F6\u957F",key:"length",render(d){return P("span",ge(d.time).format("mm:ss"))}},{title:"\u64CD\u4F5C",key:"action",width:100,render(d){return[P(ne,{size:"small",onClick:()=>{i(d)}},{default:()=>"\u64AD\u653E"}),P(ne,{size:"small",onClick:()=>{S(d)}},{default:()=>"\u79FB\u9664"})]}}],o=b(n.songs),x=b(n.currentIndex);n.$subscribe((i,d)=>{o.value=d.songs,e.value=!1,setTimeout(()=>{e.value=!0},0)}),console.log(o.value),T(o,i=>{console.log(i)});const w=i=>{let d=o.value.findIndex(C=>C.id===i.id);x.value=d,n.currentIndex=d,console.log(d,o.value.length)},S=i=>{console.log(i);let d=o.value.findIndex(C=>C.id===i.id);o.value.splice(d,1),console.log(d,o.value.length)},q=v({play:w});return(i,d)=>{const C=r("n-data-table");return m(),y("div",yt,[e.value?(m(),U(C,{key:0,columns:c(q),data:o.value,bordered:!1,"max-height":400,"row-class-name":p},null,8,["columns","data"])):X("",!0)])}}});const kt={class:"player"},xt=["src"],Ct={class:"control"},$t={class:"vol"},It={class:"showMusicBox"},bt={style:{"margin-right":"150px"}},Bt={style:{position:"relative"}},Lt={class:"lyrics-container"},St=k({__name:"player",setup(f){const n=le(),e=xe({isPlaying:!1,active:!1,activeList:!1,currentTime:0,cover:"",name:"",length:0,progress:0,duration:0,volume:30,lyric:[],currentLine:-1,animationPlayState:"paused"}),{isPlaying:p,active:v,activeList:o,currentTime:x,cover:w,name:S,length:q,progress:i,duration:d,volume:C,lyric:a,currentLine:B,animationPlayState:F}=Ce(e),$=b(n.songs[n.currentIndex]);J(()=>{h.value.volume=C.value/100,h.value.src=$.value.src,e.lyric=Q($.value.Lyric)}),T($,_=>{console.log("currentSong",_),e.lyric=Q(_.Lyric),console.log("lyric",e.lyric),E()}),n.$subscribe((_,u)=>{$.value=u.songs[u.currentIndex]});const h=b(null),z=_=>{if(e.currentTime=Math.floor(h.value.currentTime),e.progress=e.currentTime/e.duration*100,!a.value)return;for(let g=0;g<a.value.length;g++)if(g===a.value.length-1||x.value<a.value[g+1].time){B.value=g;break}const u=document.querySelector(".lyrics-container li.active");if(u){const g=document.querySelector(".lyrics-container ul");g.scrollTop=u.offsetTop-g.clientHeight/2+u.clientHeight}},H=_=>{e.duration=Math.floor(h.value.duration),console.log("durationchange",e.duration)},O=()=>{console.log("ended")},E=()=>{e.isPlaying=!0,e.animationPlayState="running",ae(()=>{h.value.play()})},ce=()=>{e.isPlaying=!1,e.animationPlayState="paused",ae(()=>{h.value.pause()})},ie=()=>{e.isPlaying=!e.isPlaying,e.isPlaying?E():ce()},de=()=>{n.currentIndex==0?n.currentIndex=n.songs.length-1:n.currentIndex--,E()},_e=()=>{n.currentIndex==n.songs.length-1?n.currentIndex=0:n.currentIndex++,E()},K=_=>{const u=Math.floor(_/60),g=(_%60).toFixed(0);return`${u}:${g.toString().padStart(2,"0")}`},pe=_=>K(_*e.duration/100);T(i,_=>{});const me=()=>{let _=e.progress*e.duration/100;isNaN(_)||(h.value.currentTime=_)},ve=_=>{h.value.volume=_/100},Q=_=>_?_.split(`
`).map(g=>{const L=g.match(/^\[(\d{2}):(\d{2}\.\d{2,3})\](.*)/);if(L){const V=parseInt(L[1]),G=parseFloat(L[2]),R=L[3].trim();return{time:V*60+G,text:R}}else return null}).filter(g=>g!==null):void 0;return(_,u)=>{const g=r("n-image"),L=r("n-icon"),V=r("n-button"),G=r("n-button-group"),R=r("n-slider"),W=r("n-drawer-content"),Y=r("n-drawer");return m(),y("div",kt,[l("audio",{ref_key:"audio",ref:h,src:$.value.src,onTimeupdate:z,onDurationchange:H,onEnded:O},null,40,xt),t(g,{width:"60",src:$.value.cover,onClick:u[0]||(u[0]=I=>v.value=!0),"preview-disabled":""},null,8,["src"]),l("span",null,D($.value.title),1),l("div",Ct,[t(G,null,{default:s(()=>[t(V,{round:"",onClick:de},{icon:s(()=>[t(L,null,{default:s(()=>[t(c(Je))]),_:1})]),_:1}),t(V,{ghost:"",onClick:ie},{icon:s(()=>[t(L,null,{default:s(()=>[oe(t(c(Ne),null,null,512),[[se,c(p)]]),oe(t(c(Oe),null,null,512),[[se,!c(p)]])]),_:1})]),_:1}),t(V,{round:"",onClick:_e},{icon:s(()=>[t(L,null,{default:s(()=>[t(c(Ze))]),_:1})]),_:1})]),_:1}),l("span",null,D(K(c(x)))+" / "+D(K(c(d))),1),t(R,{value:c(i),"onUpdate:value":u[1]||(u[1]=I=>N(i)?i.value=I:null),min:0,max:100,step:.01,onDragend:me,"format-tooltip":pe},null,8,["value"]),l("div",$t,[t(L,null,{default:s(()=>[t(c(lt))]),_:1}),t(R,{value:c(C),"onUpdate:value":[u[2]||(u[2]=I=>N(C)?C.value=I:null),ve],min:0,max:100,step:.01},null,8,["value"]),t(L,{onClick:u[3]||(u[3]=I=>o.value=!0)},{default:s(()=>[t(c(Te))]),_:1})])]),t(Y,{show:c(v),"onUpdate:show":u[4]||(u[4]=I=>N(v)?v.value=I:null),class:"lyric-drawer",placement:"top",to:"#my-music","mask-closable":!1,"show-mask":!1},{default:s(()=>[t(W,{title:"\u6B4C\u8BCD\u9875",closable:""},{default:s(()=>[l("div",It,[l("div",bt,[l("div",Bt,[t(g,{width:"250",style:$e({animationPlayState:c(F)}),src:$.value.cover+"?param=350y350"},null,8,["style","src"])])]),l("div",Lt,[l("ul",null,[(m(!0),y(Ie,null,be(c(a),(I,Z)=>(m(),y("li",{key:Z,class:Be({active:c(B)===Z})},D(I.text),3))),128))])])])]),_:1})]),_:1},8,["show"]),t(Y,{show:c(o),"onUpdate:show":u[5]||(u[5]=I=>N(o)?o.value=I:null),width:502,placement:"right",to:"#my-music"},{default:s(()=>[t(W,{title:"\u64AD\u653E\u5217\u8868"},{default:s(()=>[t(wt)]),_:1})]),_:1},8,["show"])])}}});var Ft=j(St,[["__scopeId","data-v-c4efb8e4"]]);const Pt=k({__name:"index",setup(f){return(n,e)=>{const p=r("n-layout-header"),v=r("n-layout-sider"),o=r("RouterView"),x=r("n-layout-content"),w=r("n-layout"),S=r("n-layout-footer");return m(),U(w,{id:"my-music"},{default:s(()=>[t(p,{class:"music-header",style:{"background-color":"red"}},{default:s(()=>[t(ht)]),_:1}),t(w,{"has-sider":""},{default:s(()=>[t(v,{class:"music-left","content-style":"padding: 10px;","collapse-mode":"width"},{default:s(()=>[t(ft)]),_:1}),t(x,{class:"music-content","content-style":"padding: 24px;background-color: white"},{default:s(()=>[t(o)]),_:1})]),_:1}),t(S,{class:"music-footer",style:{"background-color":"rgb(177, 171, 171)"}},{default:s(()=>[t(Ft)]),_:1})]),_:1})}}});var Vt=j(Pt,[["__scopeId","data-v-40bd0dbe"]]);export{Vt as default};
