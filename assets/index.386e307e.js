import{l as he,a as R,b as ge,u as Y,m as se,h as fe}from"./moment.fe5c1f30.js";import{f as x,a as m,b as y,d as r,h as ye,G as ae,r as b,i as we,w as V,o as G,g as N,j as a,k as K,l as t,m as xe,u as re,n as l,q as z,s as c,t as M,p as ke,e as Ce,v as F,R as Z,N as ee,x as $e,y as Ie,z as A,A as te,B as ne,C as be,F as Be,D as Le,E as Se,H as oe}from"./index.8b97e6fb.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";var Fe="./assets/logo.8db43109.png";const Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ze=r("path",{d:"M315.27 33L96 304h128l-31.51 173.23a2.36 2.36 0 0 0 2.33 2.77h0a2.36 2.36 0 0 0 1.89-.95L416 208H288l31.66-173.25a2.45 2.45 0 0 0-2.44-2.75h0a2.42 2.42 0 0 0-1.95 1z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Me=[ze];var De=x({name:"FlashOutline",render:function(n,e){return m(),y("svg",Pe,Me)}});const Ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Te=ye('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),qe=[Te];var Ee=x({name:"List",render:function(n,e){return m(),y("svg",Ve,qe)}});const Re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=r("path",{d:"M208 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Ne=r("path",{d:"M352 432h-48a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h48a16 16 0 0 1 16 16v320a16 16 0 0 1-16 16z",fill:"currentColor"},null,-1),Ue=[Ae,Ne];var je=x({name:"Pause",render:function(n,e){return m(),y("svg",Re,Ue)}});const He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=r("path",{d:"M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440z",fill:"currentColor"},null,-1),Ke=[Oe];var Ge=x({name:"Play",render:function(n,e){return m(),y("svg",He,Ke)}});const Xe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Je=r("path",{d:"M112 64a16 16 0 0 1 16 16v136.43L360.77 77.11a35.13 35.13 0 0 1 35.77-.44c12 6.8 19.46 20 19.46 34.33v290c0 14.37-7.46 27.53-19.46 34.33a35.14 35.14 0 0 1-35.77-.45L128 295.57V432a16 16 0 0 1-32 0V80a16 16 0 0 1 16-16z",fill:"currentColor"},null,-1),Qe=[Je];var We=x({name:"PlaySkipBack",render:function(n,e){return m(),y("svg",Xe,Qe)}});const Ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ze=r("path",{d:"M400 64a16 16 0 0 0-16 16v136.43L151.23 77.11a35.13 35.13 0 0 0-35.77-.44C103.46 83.47 96 96.63 96 111v290c0 14.37 7.46 27.53 19.46 34.33a35.14 35.14 0 0 0 35.77-.45L384 295.57V432a16 16 0 0 0 32 0V80a16 16 0 0 0-16-16z",fill:"currentColor"},null,-1),et=[Ze];var tt=x({name:"PlaySkipForward",render:function(n,e){return m(),y("svg",Ye,et)}});const nt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ot=r("path",{d:"M232 416a23.88 23.88 0 0 1-14.2-4.68a8.27 8.27 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8.27 8.27 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24zm-106.18-80zm-.27-159.86z",fill:"currentColor"},null,-1),st=r("path",{d:"M320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81c0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336z",fill:"currentColor"},null,-1),at=r("path",{d:"M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8z",fill:"currentColor"},null,-1),rt=r("path",{d:"M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432z",fill:"currentColor"},null,-1),lt=[ot,st,at,rt];var ut=x({name:"VolumeHigh",render:function(n,e){return m(),y("svg",nt,lt)}});const ct={class:"user"},it={class:"username"},dt=["src"],_t=x({__name:"user",setup(g){const n=xe("reload"),e=ae();re();const _=b(!1),v=b(""),s=we(()=>e.isLogin);V(s,o=>{});const f=b("\u626B\u7801\u767B\u5F55");G(async()=>{const{data:o}=await he();!o.data.account||o.data.account.status==-10?e.isLogin=!1:(e.isLogin=!0,e.userInfo=o.data.profile)});async function B(o){return(await R({url:`http://120.48.115.17:3000/login/qr/check?key=${o}&timestamp=${Date.now()}`})).data}async function S(o=""){const p=await R({url:`http://120.48.115.17:3000/login/status?timestamp=${Date.now()}`,method:"post",data:{cookie:o}});return console.log(p.data),p.data}async function T(){_.value=!0;let o;S(e.cookie);const k=(await R({url:`http://120.48.115.17:3000/login/qr/key?timestamp=${Date.now()}`})).data.data.unikey,P=await R({url:`http://120.48.115.17:3000/login/qr/create?key=${k}&qrimg=true&timestamp=${Date.now()}`});v.value=P.data.data.qrimg,o=setInterval(async()=>{const L=await B(k);if(L.code===800&&(f.value="\u4E8C\u7EF4\u7801\u5DF2\u8FC7\u671F,\u8BF7\u91CD\u65B0\u83B7\u53D6",clearInterval(o)),L.code===803){clearInterval(o),f.value="\u767B\u5F55\u6210\u529F",console.log(L);let w=await S(L.cookie);console.log(w),e.isLogin=!0,e.userInfo=w.data.profile,e.cookie=L.cookie,_.value=!1,n()}},3e3)}const d=async()=>{const{data:o}=await ge();console.log(o),o.code===200&&(e.isLogin=!1,e.userInfo={},e.qrKey="",n())};return(o,p)=>{const k=l("n-button"),P=l("n-avatar"),L=l("n-popover"),w=l("n-card"),C=l("n-modal");return m(),y("div",ct,[s.value?K("",!0):(m(),N(k,{key:0,quaternary:"",onClick:T},{default:a(()=>[z(" \u767B\u5F55 ")]),_:1})),s.value?(m(),N(L,{key:1,width:"trigger"},{trigger:a(()=>[r("div",null,[t(P,{round:"",size:24,src:c(e).userInfo.avatarUrl},null,8,["src"]),z(),r("span",it,M(c(e).userInfo.nickname),1)])]),default:a(()=>[t(k,{size:"small",onClick:d},{default:a(()=>[z(" \u9000\u51FA\u767B\u5F55 ")]),_:1})]),_:1})):K("",!0),t(C,{show:_.value,"onUpdate:show":p[0]||(p[0]=j=>_.value=j)},{default:a(()=>[t(w,{style:{width:"600px"},title:"\u767B\u5F55",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":a(()=>[z(" X ")]),footer:a(()=>[z(M(f.value),1)]),default:a(()=>[r("img",{src:v.value,alt:""},null,8,dt)]),_:1})]),_:1},8,["show"])])}}});var pt=U(_t,[["__scopeId","data-v-d066c0d2"]]);const mt=g=>(ke("data-v-58202a66"),g=g(),Ce(),g),vt={class:"music-header"},ht=mt(()=>r("span",{class:"title"},"\u7F51\u6613\u4E91\u97F3\u4E50",-1)),gt=x({__name:"index",setup(g){const n=re(),e=_=>{if(_.key==="Enter"){if(console.log(n.currentRoute),n.currentRoute.value.path==="/music/search"){n.push({query:{keywords:_.target.value}});return}n.push({path:"/music/search",query:{keywords:_.target.value}})}};return(_,v)=>{const s=l("n-avatar"),f=l("n-icon"),B=l("n-input");return m(),y("div",vt,[t(s,{round:"",size:48,src:c(Fe)},null,8,["src"]),z(),ht,t(B,{placeholder:"\u641C\u7D22",onKeyup:e},{prefix:a(()=>[t(f,{component:c(De)},null,8,["component"])]),_:1}),t(pt)])}}});var ft=U(gt,[["__scopeId","data-v-58202a66"]]);const yt={class:"left-menu"},wt=x({__name:"index",setup(g){const n=ae(),e=b([]);V(()=>n.userInfo.userId,v=>{v&&Y(n.userInfo.userId).then(s=>{console.log(s.data.playlist)})}),G(()=>{n.userInfo.userId&&Y(n.userInfo.userId).then(v=>{v.data.playlist.forEach(s=>{e.value.push({label:()=>F(Z,{to:{name:"songSheet",query:{id:s.id}}},{default:()=>s.name}),key:s.id,icon:()=>F("img",{src:s.coverImgUrl+"?param=40y40",class:"listcover"})})})})});const _=b([{label:()=>F(Z,{to:{name:"mainPage",params:{}}},{default:()=>"\u4E3A\u6211\u63A8\u8350"}),key:"recommend"},{label:"\u6392\u884C\u699C",key:"rank"},{label:"\u6536\u85CF",key:"songList",children:e}]);return(v,s)=>{const f=l("n-menu");return m(),y("div",yt,[t(f,{options:_.value,indent:10},null,8,["options"])])}}});const xt={class:"songList"},kt=x({__name:"playList",setup(g){const n=se(),e=b(!0),_=d=>d.id===n.songs[n.currentIndex].id?"current":"",v=({play:d})=>[{title:"\u5C01\u9762",key:"cover",width:80,render(o){return F("img",{src:o.cover,class:"songcover"})}},{title:"\u6807\u9898",key:"title"},{title:"\u6B4C\u624B",key:"singer"},{title:"\u65F6\u957F",key:"length",render(o){return F("span",fe(o.time).format("mm:ss"))}},{title:"\u64CD\u4F5C",key:"action",width:100,render(o){return[F(ee,{size:"small",onClick:()=>{d(o)}},{default:()=>"\u64AD\u653E"}),F(ee,{size:"small",onClick:()=>{S(o)}},{default:()=>"\u79FB\u9664"})]}}],s=b(n.songs),f=b(n.currentIndex);n.$subscribe((d,o)=>{s.value=o.songs,e.value=!1,setTimeout(()=>{e.value=!0},0)}),console.log(s.value),V(s,d=>{console.log(d)});const B=d=>{let o=s.value.findIndex(p=>p.id===d.id);f.value=o,n.currentIndex=o,console.log(o,s.value.length)},S=d=>{console.log(d);let o=s.value.findIndex(p=>p.id===d.id);s.value.splice(o,1),console.log(o,s.value.length)},T=v({play:B});return(d,o)=>{const p=l("n-data-table");return m(),y("div",xt,[e.value?(m(),N(p,{key:0,columns:c(T),data:s.value,bordered:!1,"max-height":400,"row-class-name":_},null,8,["columns","data"])):K("",!0)])}}});const Ct={class:"player"},$t=["src"],It={class:"control"},bt={class:"vol"},Bt={class:"showMusicBox"},Lt={style:{"margin-right":"150px"}},St={style:{position:"relative"}},Ft={class:"lyrics-container"},Pt=x({__name:"player",setup(g){const n=se(),e=$e({isPlaying:!1,active:!1,activeList:!1,currentTime:0,cover:"",name:"",length:0,progress:0,duration:0,volume:30,lyric:[],currentLine:-1,animationPlayState:"paused"}),{isPlaying:_,active:v,activeList:s,currentTime:f,cover:B,name:S,length:T,progress:d,duration:o,volume:p,lyric:k,currentLine:P,animationPlayState:L}=Ie(e),w=b(n.songs[n.currentIndex]);G(()=>{C.value.volume=p.value/100,C.value.src=w.value.src,e.lyric=X(w.value.Lyric)}),V(w,i=>{console.log("currentSong",i),e.lyric=X(i.Lyric),console.log("lyric",e.lyric),q()}),n.$subscribe((i,u)=>{w.value=u.songs[u.currentIndex]});const C=b(null),j=i=>{if(e.currentTime=Math.floor(C.value.currentTime),e.progress=e.currentTime/e.duration*100,!k.value)return;for(let h=0;h<k.value.length;h++)if(h===k.value.length-1||f.value<k.value[h+1].time){P.value=h;break}const u=document.querySelector(".lyrics-container li.active");if(u){const h=document.querySelector(".lyrics-container ul");h.scrollTop=u.offsetTop-h.clientHeight/2+u.clientHeight}},le=i=>{e.duration=Math.floor(C.value.duration),console.log("durationchange",e.duration)},ue=()=>{console.log("ended")},q=()=>{e.isPlaying=!0,e.animationPlayState="running",oe(()=>{C.value.play()})},ce=()=>{e.isPlaying=!1,e.animationPlayState="paused",oe(()=>{C.value.pause()})},ie=()=>{e.isPlaying=!e.isPlaying,e.isPlaying?q():ce()},de=()=>{n.currentIndex==0?n.currentIndex=n.songs.length-1:n.currentIndex--,q()},_e=()=>{n.currentIndex==n.songs.length-1?n.currentIndex=0:n.currentIndex++,q()},H=i=>{const u=Math.floor(i/60),h=(i%60).toFixed(0);return`${u}:${h.toString().padStart(2,"0")}`},pe=i=>H(i*e.duration/100);V(d,i=>{});const me=()=>{let i=e.progress*e.duration/100;isNaN(i)||(C.value.currentTime=i)},ve=i=>{C.value.volume=i/100},X=i=>i?i.split(`
`).map(h=>{const I=h.match(/^\[(\d{2}):(\d{2}\.\d{2,3})\](.*)/);if(I){const D=parseInt(I[1]),O=parseFloat(I[2]),E=I[3].trim();return{time:D*60+O,text:E}}else return null}).filter(h=>h!==null):void 0;return(i,u)=>{const h=l("n-image"),I=l("n-icon"),D=l("n-button"),O=l("n-button-group"),E=l("n-slider"),J=l("n-drawer-content"),Q=l("n-drawer");return m(),y("div",Ct,[r("audio",{ref_key:"audio",ref:C,src:w.value.src,onTimeupdate:j,onDurationchange:le,onEnded:ue},null,40,$t),t(h,{width:"60",src:w.value.cover,onClick:u[0]||(u[0]=$=>v.value=!0),"preview-disabled":""},null,8,["src"]),r("span",null,M(w.value.title),1),r("div",It,[t(O,null,{default:a(()=>[t(D,{round:"",onClick:de},{icon:a(()=>[t(I,null,{default:a(()=>[t(c(We))]),_:1})]),_:1}),t(D,{ghost:"",onClick:ie},{icon:a(()=>[t(I,null,{default:a(()=>[te(t(c(je),null,null,512),[[ne,c(_)]]),te(t(c(Ge),null,null,512),[[ne,!c(_)]])]),_:1})]),_:1}),t(D,{round:"",onClick:_e},{icon:a(()=>[t(I,null,{default:a(()=>[t(c(tt))]),_:1})]),_:1})]),_:1}),r("span",null,M(H(c(f)))+" / "+M(H(c(o))),1),t(E,{value:c(d),"onUpdate:value":u[1]||(u[1]=$=>A(d)?d.value=$:null),min:0,max:100,step:.01,onDragend:me,"format-tooltip":pe},null,8,["value"]),r("div",bt,[t(I,null,{default:a(()=>[t(c(ut))]),_:1}),t(E,{value:c(p),"onUpdate:value":[u[2]||(u[2]=$=>A(p)?p.value=$:null),ve],min:0,max:100,step:.01},null,8,["value"]),t(I,{onClick:u[3]||(u[3]=$=>s.value=!0)},{default:a(()=>[t(c(Ee))]),_:1})])]),t(Q,{show:c(v),"onUpdate:show":u[4]||(u[4]=$=>A(v)?v.value=$:null),class:"lyric-drawer",placement:"top",to:"#my-music","mask-closable":!1,"show-mask":!1},{default:a(()=>[t(J,{title:"\u6B4C\u8BCD\u9875",closable:""},{default:a(()=>[r("div",Bt,[r("div",Lt,[r("div",St,[t(h,{width:"250",style:be({animationPlayState:c(L)}),src:w.value.cover+"?param=350y350"},null,8,["style","src"])])]),r("div",Ft,[r("ul",null,[(m(!0),y(Be,null,Le(c(k),($,W)=>(m(),y("li",{key:W,class:Se({active:c(P)===W})},M($.text),3))),128))])])])]),_:1})]),_:1},8,["show"]),t(Q,{show:c(s),"onUpdate:show":u[5]||(u[5]=$=>A(s)?s.value=$:null),width:502,placement:"right",to:"#my-music"},{default:a(()=>[t(J,{title:"\u64AD\u653E\u5217\u8868"},{default:a(()=>[t(kt)]),_:1})]),_:1},8,["show"])])}}});var zt=U(Pt,[["__scopeId","data-v-c4efb8e4"]]);const Mt=x({__name:"index",setup(g){return(n,e)=>{const _=l("n-layout-header"),v=l("n-layout-sider"),s=l("RouterView"),f=l("n-layout-content"),B=l("n-layout"),S=l("n-layout-footer");return m(),N(B,{id:"my-music"},{default:a(()=>[t(_,{class:"music-header",style:{"background-color":"red"}},{default:a(()=>[t(ft)]),_:1}),t(B,{"has-sider":""},{default:a(()=>[t(v,{class:"music-left","content-style":"padding: 10px;","collapse-mode":"width"},{default:a(()=>[t(wt)]),_:1}),t(f,{class:"music-content","content-style":"padding: 24px;background-color: white"},{default:a(()=>[t(s)]),_:1})]),_:1}),t(S,{class:"music-footer",style:{"background-color":"rgb(177, 171, 171)"}},{default:a(()=>[t(zt)]),_:1})]),_:1})}}});var qt=U(Mt,[["__scopeId","data-v-40bd0dbe"]]);export{qt as default};
